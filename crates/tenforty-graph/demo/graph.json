{
  "meta": {
    "form_id": "us_1040_enhanced",
    "year": 2024,
    "generated_by": "enhanced demo"
  },
  "nodes": {
    "0": { "id": 0, "op": { "type": "input" }, "name": "wages" },
    "1": { "id": 1, "op": { "type": "input" }, "name": "interest" },
    "2": { "id": 2, "op": { "type": "input" }, "name": "dividends" },
    "3": { "id": 3, "op": { "type": "input" }, "name": "short_term_capital_gains" },
    "4": { "id": 4, "op": { "type": "input" }, "name": "long_term_capital_gains" },
    "5": { "id": 5, "op": { "type": "input" }, "name": "iso_exercise_gains" },

    "10": { "id": 10, "op": { "type": "literal", "value": 14600 }, "name": "std_ded_single" },
    "11": { "id": 11, "op": { "type": "literal", "value": 29200 }, "name": "std_ded_mfj" },
    "12": { "id": 12, "op": { "type": "literal", "value": 14600 }, "name": "std_ded_mfs" },
    "13": { "id": 13, "op": { "type": "literal", "value": 21900 }, "name": "std_ded_hoh" },
    "14": { "id": 14, "op": { "type": "literal", "value": 29200 }, "name": "std_ded_qw" },
    "15": { "id": 15, "op": { "type": "by_status", "values": {
      "single": 10,
      "married_joint": 11,
      "married_separate": 12,
      "head_of_household": 13,
      "qualifying_widow": 14
    }}, "name": "standard_deduction" },

    "20": { "id": 20, "op": { "type": "add", "left": 0, "right": 1 }, "name": "wages_plus_interest" },
    "21": { "id": 21, "op": { "type": "add", "left": 20, "right": 2 }, "name": "plus_dividends" },
    "22": { "id": 22, "op": { "type": "add", "left": 21, "right": 3 }, "name": "plus_stcg" },
    "23": { "id": 23, "op": { "type": "add", "left": 22, "right": 4 }, "name": "gross_income" },

    "25": { "id": 25, "op": { "type": "add", "left": 0, "right": 1 }, "name": "ordinary_income_base" },
    "26": { "id": 26, "op": { "type": "add", "left": 25, "right": 2 }, "name": "ordinary_income_plus_div" },
    "27": { "id": 27, "op": { "type": "add", "left": 26, "right": 3 }, "name": "ordinary_income" },

    "30": { "id": 30, "op": { "type": "sub", "left": 27, "right": 15 }, "name": "taxable_ordinary_raw" },
    "31": { "id": 31, "op": { "type": "literal", "value": 0 }, "name": "zero" },
    "32": { "id": 32, "op": { "type": "max", "left": 30, "right": 31 }, "name": "taxable_ordinary_income" },

    "35": { "id": 35, "op": { "type": "bracket_tax", "table": "federal_2024", "income": 32 }, "name": "ordinary_income_tax" },

    "40": { "id": 40, "op": { "type": "bracket_tax_with_base", "table": "ltcg_2024", "income": 4, "base_income": 32 }, "name": "ltcg_tax" },

    "45": { "id": 45, "op": { "type": "add", "left": 35, "right": 40 }, "name": "subtotal_federal_tax" },

    "50": { "id": 50, "op": { "type": "add", "left": 1, "right": 2 }, "name": "investment_income_base" },
    "51": { "id": 51, "op": { "type": "add", "left": 50, "right": 3 }, "name": "investment_income_plus_stcg" },
    "52": { "id": 52, "op": { "type": "add", "left": 51, "right": 4 }, "name": "net_investment_income" },

    "55": { "id": 55, "op": { "type": "literal", "value": 200000 }, "name": "niit_threshold_single" },
    "56": { "id": 56, "op": { "type": "literal", "value": 250000 }, "name": "niit_threshold_mfj" },
    "57": { "id": 57, "op": { "type": "literal", "value": 125000 }, "name": "niit_threshold_mfs" },
    "58": { "id": 58, "op": { "type": "literal", "value": 200000 }, "name": "niit_threshold_hoh" },
    "59": { "id": 59, "op": { "type": "literal", "value": 250000 }, "name": "niit_threshold_qw" },
    "60": { "id": 60, "op": { "type": "by_status", "values": {
      "single": 55,
      "married_joint": 56,
      "married_separate": 57,
      "head_of_household": 58,
      "qualifying_widow": 59
    }}, "name": "niit_threshold" },

    "61": { "id": 61, "op": { "type": "sub", "left": 23, "right": 60 }, "name": "magi_over_threshold" },
    "62": { "id": 62, "op": { "type": "max", "left": 61, "right": 31 }, "name": "magi_excess" },
    "63": { "id": 63, "op": { "type": "min", "left": 52, "right": 62 }, "name": "niit_base" },
    "64": { "id": 64, "op": { "type": "literal", "value": 0.038 }, "name": "niit_rate" },
    "65": { "id": 65, "op": { "type": "mul", "left": 63, "right": 64 }, "name": "niit" },

    "70": { "id": 70, "op": { "type": "sub", "left": 0, "right": 60 }, "name": "wages_over_threshold" },
    "71": { "id": 71, "op": { "type": "max", "left": 70, "right": 31 }, "name": "wages_excess" },
    "72": { "id": 72, "op": { "type": "literal", "value": 0.009 }, "name": "medicare_surtax_rate" },
    "73": { "id": 73, "op": { "type": "mul", "left": 71, "right": 72 }, "name": "additional_medicare_tax" },

    "80": { "id": 80, "op": { "type": "add", "left": 45, "right": 65 }, "name": "federal_plus_niit" },
    "81": { "id": 81, "op": { "type": "add", "left": 80, "right": 73 }, "name": "federal_before_amt" },

    "90": { "id": 90, "op": { "type": "literal", "value": 85700 }, "name": "amt_exemption_single" },
    "91": { "id": 91, "op": { "type": "literal", "value": 133300 }, "name": "amt_exemption_mfj" },
    "92": { "id": 92, "op": { "type": "literal", "value": 66650 }, "name": "amt_exemption_mfs" },
    "93": { "id": 93, "op": { "type": "literal", "value": 85700 }, "name": "amt_exemption_hoh" },
    "94": { "id": 94, "op": { "type": "literal", "value": 133300 }, "name": "amt_exemption_qw" },
    "95": { "id": 95, "op": { "type": "by_status", "values": {
      "single": 90,
      "married_joint": 91,
      "married_separate": 92,
      "head_of_household": 93,
      "qualifying_widow": 94
    }}, "name": "amt_exemption" },

    "96": { "id": 96, "op": { "type": "literal", "value": 609350 }, "name": "amt_phaseout_single" },
    "97": { "id": 97, "op": { "type": "literal", "value": 1218700 }, "name": "amt_phaseout_mfj" },
    "98": { "id": 98, "op": { "type": "literal", "value": 609350 }, "name": "amt_phaseout_mfs" },
    "99": { "id": 99, "op": { "type": "literal", "value": 609350 }, "name": "amt_phaseout_hoh" },
    "100": { "id": 100, "op": { "type": "literal", "value": 1218700 }, "name": "amt_phaseout_qw" },
    "101": { "id": 101, "op": { "type": "by_status", "values": {
      "single": 96,
      "married_joint": 97,
      "married_separate": 98,
      "head_of_household": 99,
      "qualifying_widow": 100
    }}, "name": "amt_phaseout_start" },

    "102": { "id": 102, "op": { "type": "add", "left": 32, "right": 4 }, "name": "amti_base" },
    "103": { "id": 103, "op": { "type": "add", "left": 102, "right": 5 }, "name": "amti" },
    "104": { "id": 104, "op": { "type": "sub", "left": 103, "right": 101 }, "name": "amti_over_phaseout" },
    "105": { "id": 105, "op": { "type": "max", "left": 104, "right": 31 }, "name": "amti_excess" },
    "106": { "id": 106, "op": { "type": "literal", "value": 0.25 }, "name": "amt_phaseout_rate" },
    "107": { "id": 107, "op": { "type": "mul", "left": 105, "right": 106 }, "name": "exemption_reduction" },
    "108": { "id": 108, "op": { "type": "sub", "left": 95, "right": 107 }, "name": "exemption_after_phaseout" },
    "109": { "id": 109, "op": { "type": "max", "left": 108, "right": 31 }, "name": "amt_exemption_allowed" },
    "110": { "id": 110, "op": { "type": "sub", "left": 103, "right": 109 }, "name": "amt_taxable_income_raw" },
    "111": { "id": 111, "op": { "type": "max", "left": 110, "right": 31 }, "name": "amt_taxable_income" },
    "112": { "id": 112, "op": { "type": "bracket_tax", "table": "amt_2024", "income": 111 }, "name": "tentative_minimum_tax" },
    "113": { "id": 113, "op": { "type": "sub", "left": 112, "right": 45 }, "name": "amt_excess_raw" },
    "114": { "id": 114, "op": { "type": "max", "left": 113, "right": 31 }, "name": "amt" },

    "120": { "id": 120, "op": { "type": "add", "left": 81, "right": 114 }, "name": "federal_tax" },

    "130": { "id": 130, "op": { "type": "literal", "value": 5363 }, "name": "ca_std_ded_single" },
    "131": { "id": 131, "op": { "type": "literal", "value": 10726 }, "name": "ca_std_ded_mfj" },
    "132": { "id": 132, "op": { "type": "literal", "value": 5363 }, "name": "ca_std_ded_mfs" },
    "133": { "id": 133, "op": { "type": "literal", "value": 10726 }, "name": "ca_std_ded_hoh" },
    "134": { "id": 134, "op": { "type": "literal", "value": 10726 }, "name": "ca_std_ded_qw" },
    "135": { "id": 135, "op": { "type": "by_status", "values": {
      "single": 130,
      "married_joint": 131,
      "married_separate": 132,
      "head_of_household": 133,
      "qualifying_widow": 134
    }}, "name": "ca_standard_deduction" },

    "136": { "id": 136, "op": { "type": "sub", "left": 23, "right": 135 }, "name": "ca_taxable_raw" },
    "137": { "id": 137, "op": { "type": "max", "left": 136, "right": 31 }, "name": "ca_taxable_income" },
    "138": { "id": 138, "op": { "type": "bracket_tax", "table": "ca_2024", "income": 137 }, "name": "ca_regular_tax" },

    "140": { "id": 140, "op": { "type": "literal", "value": 1000000 }, "name": "ca_mental_health_threshold" },
    "141": { "id": 141, "op": { "type": "sub", "left": 137, "right": 140 }, "name": "ca_over_million" },
    "142": { "id": 142, "op": { "type": "max", "left": 141, "right": 31 }, "name": "ca_mental_health_base" },
    "143": { "id": 143, "op": { "type": "literal", "value": 0.01 }, "name": "ca_mental_health_rate" },
    "144": { "id": 144, "op": { "type": "mul", "left": 142, "right": 143 }, "name": "ca_mental_health_tax" },
    "145": { "id": 145, "op": { "type": "add", "left": 138, "right": 144 }, "name": "ca_state_tax" },

    "150": { "id": 150, "op": { "type": "add", "left": 120, "right": 145 }, "name": "total_tax" },

    "160": { "id": 160, "op": { "type": "div", "left": 120, "right": 23 }, "name": "effective_rate_raw" },
    "161": { "id": 161, "op": { "type": "literal", "value": 100 }, "name": "hundred" },
    "162": { "id": 162, "op": { "type": "mul", "left": 160, "right": 161 }, "name": "federal_effective_rate" },

    "165": { "id": 165, "op": { "type": "div", "left": 150, "right": 23 }, "name": "combined_rate_raw" },
    "166": { "id": 166, "op": { "type": "mul", "left": 165, "right": 161 }, "name": "combined_effective_rate" }
  },
  "tables": {
    "federal_2024": {
      "brackets": {
        "single": [
          { "threshold": 11600, "rate": 0.10 },
          { "threshold": 47150, "rate": 0.12 },
          { "threshold": 100525, "rate": 0.22 },
          { "threshold": 191950, "rate": 0.24 },
          { "threshold": 243725, "rate": 0.32 },
          { "threshold": 609350, "rate": 0.35 },
          { "threshold": 1e18, "rate": 0.37 }
        ],
        "married_joint": [
          { "threshold": 23200, "rate": 0.10 },
          { "threshold": 94300, "rate": 0.12 },
          { "threshold": 201050, "rate": 0.22 },
          { "threshold": 383900, "rate": 0.24 },
          { "threshold": 487450, "rate": 0.32 },
          { "threshold": 731200, "rate": 0.35 },
          { "threshold": 1e18, "rate": 0.37 }
        ],
        "married_separate": [
          { "threshold": 11600, "rate": 0.10 },
          { "threshold": 47150, "rate": 0.12 },
          { "threshold": 100525, "rate": 0.22 },
          { "threshold": 191950, "rate": 0.24 },
          { "threshold": 243725, "rate": 0.32 },
          { "threshold": 365600, "rate": 0.35 },
          { "threshold": 1e18, "rate": 0.37 }
        ],
        "head_of_household": [
          { "threshold": 16550, "rate": 0.10 },
          { "threshold": 63100, "rate": 0.12 },
          { "threshold": 100500, "rate": 0.22 },
          { "threshold": 191950, "rate": 0.24 },
          { "threshold": 243700, "rate": 0.32 },
          { "threshold": 609350, "rate": 0.35 },
          { "threshold": 1e18, "rate": 0.37 }
        ],
        "qualifying_widow": [
          { "threshold": 23200, "rate": 0.10 },
          { "threshold": 94300, "rate": 0.12 },
          { "threshold": 201050, "rate": 0.22 },
          { "threshold": 383900, "rate": 0.24 },
          { "threshold": 487450, "rate": 0.32 },
          { "threshold": 731200, "rate": 0.35 },
          { "threshold": 1e18, "rate": 0.37 }
        ]
      }
    },
    "ltcg_2024": {
      "brackets": {
        "single": [
          { "threshold": 47025, "rate": 0.00 },
          { "threshold": 518900, "rate": 0.15 },
          { "threshold": 1e18, "rate": 0.20 }
        ],
        "married_joint": [
          { "threshold": 94050, "rate": 0.00 },
          { "threshold": 583750, "rate": 0.15 },
          { "threshold": 1e18, "rate": 0.20 }
        ],
        "married_separate": [
          { "threshold": 47025, "rate": 0.00 },
          { "threshold": 291850, "rate": 0.15 },
          { "threshold": 1e18, "rate": 0.20 }
        ],
        "head_of_household": [
          { "threshold": 63000, "rate": 0.00 },
          { "threshold": 551350, "rate": 0.15 },
          { "threshold": 1e18, "rate": 0.20 }
        ],
        "qualifying_widow": [
          { "threshold": 94050, "rate": 0.00 },
          { "threshold": 583750, "rate": 0.15 },
          { "threshold": 1e18, "rate": 0.20 }
        ]
      }
    },
    "amt_2024": {
      "brackets": {
        "single": [
          { "threshold": 232600, "rate": 0.26 },
          { "threshold": 1e18, "rate": 0.28 }
        ],
        "married_joint": [
          { "threshold": 232600, "rate": 0.26 },
          { "threshold": 1e18, "rate": 0.28 }
        ],
        "married_separate": [
          { "threshold": 116300, "rate": 0.26 },
          { "threshold": 1e18, "rate": 0.28 }
        ],
        "head_of_household": [
          { "threshold": 232600, "rate": 0.26 },
          { "threshold": 1e18, "rate": 0.28 }
        ],
        "qualifying_widow": [
          { "threshold": 232600, "rate": 0.26 },
          { "threshold": 1e18, "rate": 0.28 }
        ]
      }
    },
    "ca_2024": {
      "brackets": {
        "single": [
          { "threshold": 10412, "rate": 0.01 },
          { "threshold": 24684, "rate": 0.02 },
          { "threshold": 38959, "rate": 0.04 },
          { "threshold": 54081, "rate": 0.06 },
          { "threshold": 68350, "rate": 0.08 },
          { "threshold": 349137, "rate": 0.093 },
          { "threshold": 418961, "rate": 0.103 },
          { "threshold": 698271, "rate": 0.113 },
          { "threshold": 1e18, "rate": 0.123 }
        ],
        "married_joint": [
          { "threshold": 20824, "rate": 0.01 },
          { "threshold": 49368, "rate": 0.02 },
          { "threshold": 77918, "rate": 0.04 },
          { "threshold": 108162, "rate": 0.06 },
          { "threshold": 136700, "rate": 0.08 },
          { "threshold": 698274, "rate": 0.093 },
          { "threshold": 837922, "rate": 0.103 },
          { "threshold": 1396542, "rate": 0.113 },
          { "threshold": 1e18, "rate": 0.123 }
        ],
        "married_separate": [
          { "threshold": 10412, "rate": 0.01 },
          { "threshold": 24684, "rate": 0.02 },
          { "threshold": 38959, "rate": 0.04 },
          { "threshold": 54081, "rate": 0.06 },
          { "threshold": 68350, "rate": 0.08 },
          { "threshold": 349137, "rate": 0.093 },
          { "threshold": 418961, "rate": 0.103 },
          { "threshold": 698271, "rate": 0.113 },
          { "threshold": 1e18, "rate": 0.123 }
        ],
        "head_of_household": [
          { "threshold": 20839, "rate": 0.01 },
          { "threshold": 49371, "rate": 0.02 },
          { "threshold": 63644, "rate": 0.04 },
          { "threshold": 78765, "rate": 0.06 },
          { "threshold": 93037, "rate": 0.08 },
          { "threshold": 474824, "rate": 0.093 },
          { "threshold": 569790, "rate": 0.103 },
          { "threshold": 949649, "rate": 0.113 },
          { "threshold": 1e18, "rate": 0.123 }
        ],
        "qualifying_widow": [
          { "threshold": 20824, "rate": 0.01 },
          { "threshold": 49368, "rate": 0.02 },
          { "threshold": 77918, "rate": 0.04 },
          { "threshold": 108162, "rate": 0.06 },
          { "threshold": 136700, "rate": 0.08 },
          { "threshold": 698274, "rate": 0.093 },
          { "threshold": 837922, "rate": 0.103 },
          { "threshold": 1396542, "rate": 0.113 },
          { "threshold": 1e18, "rate": 0.123 }
        ]
      }
    }
  },
  "inputs": [0, 1, 2, 3, 4, 5],
  "outputs": [23, 15, 32, 35, 40, 65, 73, 114, 120, 145, 150, 162, 166],
  "invariants": [
    { "type": "monotonic", "input": "wages", "output": "federal_tax" },
    { "type": "monotonic", "input": "long_term_capital_gains", "output": "federal_tax" },
    { "type": "bounds", "node": "federal_effective_rate", "min": 0, "max": 50 }
  ]
}
