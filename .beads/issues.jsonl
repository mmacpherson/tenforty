{"id":"tenforty-189","title":"MCP server core","description":"Implement the MCP server package as an optional extra. Should be installable via pip install tenforty[mcp] so it's not a default dependency.","status":"open","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T15:36:58.82699697-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T15:36:58.82699697-08:00"}
{"id":"tenforty-223","title":"evaluate_return() silently excludes SE tax, NIIT, and Additional Medicare from L24","description":"## Summary\n\n`evaluate_return()` maps natural input names (e.g. `w2_income`, `ordinary_dividends`) to form graph nodes via `NATURAL_TO_NODE` in `mappings.py`. The form graph correctly wires Schedule SE, Form 8959, and Form 8960 into Schedule 2, which flows into 1040 L23→L24 (total_tax). However, none of the subordinate forms receive the inputs they need, so they all compute as $0, and `federal_total_tax` (1040 L24) silently excludes SE tax, NIIT, and Additional Medicare Tax.\n\n## Form Graph Wiring (correct)\n\n```\nSchedule SE  L10 (se_tax)              → Schedule 2 L4 ──→ L21 ──→ 1040 L23 → L24\nForm 8959    L18 (total_addl_medicare) → Schedule 2 L8 ──┘\nForm 8960    L17 (niit)                → Schedule 2 L8 ──┘\n```\n\nSchedule 2 imports are verified in `us_schedule_2_2025.json`:\n- `us_schedule_se` L10 → Schedule 2 node 16 (`L4_self_employment_tax`)\n- `us_form_8959` L18 → Schedule 2 node 17 (`L8_8959`)\n- `us_form_8960` L17 → Schedule 2 node 18 (`L8_8960`)\n\nThese all sum into `L21_total_other_taxes` (node 35) which is an output of Schedule 2.\n\n## Missing Input Mappings\n\nThe subordinate forms have input nodes that are never populated by `NATURAL_TO_NODE`:\n\n### Schedule SE (`us_schedule_se_2025.json`)\n| Input node | Description | Mapping status |\n|---|---|---|\n| `L2_business_profit` | Net SE income (Sched C line 31) | **Not mapped** — SE income currently goes to `us_schedule_1_L8z_other_income` only |\n| `L5_w2_ss_wages` | W-2 SS wages (caps SS portion) | **Not mapped** — `w2_income` only maps to `us_1040_L1a_wages` |\n\n### Form 8960 / NIIT (`us_form_8960_2025.json`)\n| Input node | Description | Mapping status |\n|---|---|---|\n| `L1_taxable_interest` | Taxable interest | **Not mapped** — `taxable_interest` only maps to `us_1040_L2b_taxable_interest` |\n| `L2_ordinary_dividends` | Ordinary dividends | **Not mapped** — `ordinary_dividends` only maps to `us_1040_L3b_ordinary_dividends` |\n| `L4a_rental_royalty_income` | Rental/royalty income | **Not mapped** (no natural name for this) |\n| `L5a_net_gain_disposition` | Net capital gains | **Not mapped** |\n| `L13_modified_agi` | MAGI for threshold | **Not mapped** (could be derived from L11 AGI) |\n\n### Form 8959 / Additional Medicare Tax (`us_form_8959_2025.json`)\n| Input node | Description | Mapping status |\n|---|---|---|\n| `L1_medicare_wages` | W-2 Medicare wages (Box 5) | **Not mapped** — `w2_income` only maps to 1040 L1a |\n| `L8_se_income` | SE income for Part II | **Not mapped** |\n| `L19_medicare_withheld` | Medicare tax withheld (W-2 Box 6) | **Not mapped** |\n\n## Result\n\nAll four subordinate forms receive zero inputs and compute $0. L24 = income tax + AMT only.\n\n## Real-World Impact\n\nFor a typical MFJ return with ~$400K AGI, $45K SE income, and $160K investment income above the $250K threshold:\n- **SE tax missing**: ~$6,400 (12.4% SS on ~$42K + 2.9% Medicare)\n- **NIIT missing**: ~$5,800 (3.8% on NII above threshold)\n- **Additional Medicare missing**: ~$400 (0.9% on wages+SE above $250K)\n- **Total undercount**: ~$7,400+ (≈9% of total tax)\n\n## Downstream Workaround\n\nThe `taxes-2025` project (`estimate_taxes.py`) works around this by computing SE tax and NIIT manually after calling `evaluate_return()` and adding them to the total. This is safe today because the unfed forms produce $0, so there's no double-counting. But it's fragile — if someone fixes the input mappings without updating callers, they'd suddenly double-count.\n\n## Proposed Fix\n\n1. **Add new natural input names** for SE income:\n   - `self_employment_income` → dual-map to both `us_schedule_1_L8z_other_income` AND `us_schedule_se_L2_business_profit`\n   - Or add a separate `schedule_se_business_profit` natural name\n\n2. **Dual-map existing inputs** to subordinate forms:\n   - `w2_income` → also map to `us_schedule_se_L5_w2_ss_wages` and `us_form_8959_L1_medicare_wages`\n   - `taxable_interest` → also map to `us_form_8960_L1_taxable_interest`\n   - `ordinary_dividends` → also map to `us_form_8960_L2_ordinary_dividends`\n\n3. **Add new natural inputs** for investment income detail:\n   - `rental_income` → `us_form_8960_L4a_rental_royalty_income`\n   - Capital gains already mapped to Schedule D could also feed Form 8960 L5a\n\n4. **Wire MAGI for NIIT threshold**: Form 8960 L13 needs MAGI — could be an import from 1040 L11 AGI\n\n5. **Expose intermediate values** on `InterpretedTaxReturn`:\n   - `se_tax`, `niit`, `additional_medicare_tax` for downstream inspection\n\n### Challenge: NATURAL_TO_NODE is 1:1\n\nCurrently `NATURAL_TO_NODE` maps each natural name to a single graph node. Dual-mapping (one natural name → multiple nodes) would require changing the mapping infrastructure. Alternatively, the graph resolver could auto-propagate matching field names across forms, or new distinct natural names could be added for each subordinate form input.\n\n## Out of Scope\n\n- Form 8801 (AMT credit carryforward from prior years) — no form definition exists in tenforty, would be a separate issue\n- Schedule 1 L15 (SE tax deduction, the \"above the line\" half) — Schedule SE L11 computes this but Schedule 1 doesn't import it","status":"open","priority":1,"issue_type":"bug","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-10T09:57:09.13316777-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-10T09:58:19.721620028-08:00"}
{"id":"tenforty-24a","title":"OTS backend sample-mode support","description":"Support sample-mode evaluation for the OTS backend. Currently each OTS scenario is evaluated individually in Python. At minimum, evaluate samples without forming a Cartesian product. Stretch: parallelize via threading (if Cython releases GIL) or multiprocessing. Key files: src/tenforty/core.py (OTS path), src/tenforty/otslib/","status":"closed","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:31:23.525071172-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T20:44:55.266757219-08:00","closed_at":"2026-02-08T20:44:55.266757219-08:00","close_reason":"Implemented: Rust eval_scenarios_zip, Python evaluate_batch_zip/evaluate_returns_zip, OTS fallback in evaluate_returns_zip"}
{"id":"tenforty-39l","title":"Add OTS state support for 2024 (NC, NJ, PA, VA, OH, MI, OR)","description":"Add NaturalFormMapping configs and xfail parity tests for all 7 states available in OTS 2024 that don't yet have configs: NC_D400, NJ_1040, PA_40, VA_760, OH_IT1040, MI_1040, OR_40. Follow the same pattern as PR #209. Key files: src/tenforty/models.py, tests/parity/","status":"open","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:48:40.349864029-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T16:48:40.349864029-08:00"}
{"id":"tenforty-6t0","title":"Prior-year OTS state support","description":"Backport OTS state support (NaturalFormMapping configs + parity tests) from 2025 to prior tax years. Currently only federal/CA/MA/NY have configs for 2018-2024; the 6 states added in PR #209 (NC, NJ, PA, VA, OH, MI) need configs for prior years too. OR/MI only available from 2024.","status":"open","priority":2,"issue_type":"feature","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:48:38.335295112-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T16:48:38.335295112-08:00","dependencies":[{"issue_id":"tenforty-6t0","depends_on_id":"tenforty-39l","type":"blocks","created_at":"2026-02-08T16:49:01.372757337-08:00","created_by":"Mike Macpherson"},{"issue_id":"tenforty-6t0","depends_on_id":"tenforty-s66","type":"blocks","created_at":"2026-02-08T16:49:03.63343432-08:00","created_by":"Mike Macpherson"},{"issue_id":"tenforty-6t0","depends_on_id":"tenforty-8vx","type":"blocks","created_at":"2026-02-08T16:49:05.085826809-08:00","created_by":"Mike Macpherson"}]}
{"id":"tenforty-8vx","title":"Add OTS state support for 2022 (NC, NJ, PA, VA, OH)","description":"Same as 2023 task but for 2022. Same 5 states (NC_D400, NJ_1040, PA_40, VA_760, OH_IT1040). Add NaturalFormMapping configs and xfail parity tests. Key files: src/tenforty/models.py, tests/parity/","status":"open","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:48:43.950390851-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T16:48:43.950390851-08:00"}
{"id":"tenforty-cds","title":"Sampling/distribution layer","description":"Higher-level API for specifying distributions over tax inputs (e.g., w2_income ~ Normal(80000, 5000)) and generating samples automatically. Builds on top of the sample-mode evaluation engine. Integrate with numpy/scipy distributions.","status":"open","priority":3,"issue_type":"feature","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:31:25.456262236-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T16:31:25.456262236-08:00","dependencies":[{"issue_id":"tenforty-cds","depends_on_id":"tenforty-don","type":"blocks","created_at":"2026-02-08T16:32:26.325598633-08:00","created_by":"Mike Macpherson"}]}
{"id":"tenforty-don","title":"Sample-mode batch evaluation","description":"Support evaluating pre-formed sample configurations (zip semantics) in addition to the existing Cartesian product mode. Enables Monte Carlo / Bayesian tax estimation where some inputs are fixed and others are drawn from distributions externally.","status":"closed","priority":2,"issue_type":"feature","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:31:09.973257695-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T20:45:28.430790882-08:00","closed_at":"2026-02-08T20:45:28.430790882-08:00","close_reason":"All sub-tasks complete: Rust zip eval, Python API, OTS fallback. evaluate_returns_zip() is fully functional.","dependencies":[{"issue_id":"tenforty-don","depends_on_id":"tenforty-nek","type":"blocks","created_at":"2026-02-08T16:32:01.23318052-08:00","created_by":"Mike Macpherson"},{"issue_id":"tenforty-don","depends_on_id":"tenforty-osu","type":"blocks","created_at":"2026-02-08T16:32:01.272563707-08:00","created_by":"Mike Macpherson"},{"issue_id":"tenforty-don","depends_on_id":"tenforty-24a","type":"blocks","created_at":"2026-02-08T16:32:01.304848373-08:00","created_by":"Mike Macpherson"}]}
{"id":"tenforty-e6p","title":"MCP tutorial docs","description":"Write usage documentation with scenarios and use cases for the MCP server.","status":"open","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T15:37:02.904564461-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T15:37:02.904564461-08:00"}
{"id":"tenforty-i6o","title":"Epic: Add MCP server to tenforty","description":"Expose tenforty functionality via MCP (Model Context Protocol) server. Install as an optional extra (pip install tenforty[mcp]) — not a default dependency. Include a Makefile with a small 'make API' for common tasks. Tutorial docs with scenarios and use cases.","status":"open","priority":2,"issue_type":"feature","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T15:36:52.789825556-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T15:36:52.789825556-08:00","dependencies":[{"issue_id":"tenforty-i6o","depends_on_id":"tenforty-189","type":"blocks","created_at":"2026-02-08T15:41:35.302612086-08:00","created_by":"Mike Macpherson"},{"issue_id":"tenforty-i6o","depends_on_id":"tenforty-uur","type":"blocks","created_at":"2026-02-08T16:21:47.34551626-08:00","created_by":"Mike Macpherson"},{"issue_id":"tenforty-i6o","depends_on_id":"tenforty-e6p","type":"blocks","created_at":"2026-02-08T16:21:48.397849353-08:00","created_by":"Mike Macpherson"}]}
{"id":"tenforty-nek","title":"Python API for sample-mode evaluation","description":"Add a way to pass pre-formed samples to the evaluation pipeline — either a new function (evaluate_samples()) or a mode parameter on evaluate_returns(). Input: equal-length lists per parameter (zipped, not crossed). Should support both materialized lists and iterables/generators for memory efficiency with large Monte Carlo runs. Key files: src/tenforty/core.py","status":"closed","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:31:19.869031377-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T20:44:55.263566762-08:00","closed_at":"2026-02-08T20:44:55.263566762-08:00","close_reason":"Implemented: Rust eval_scenarios_zip, Python evaluate_batch_zip/evaluate_returns_zip, OTS fallback in evaluate_returns_zip","dependencies":[{"issue_id":"tenforty-nek","depends_on_id":"tenforty-osu","type":"blocks","created_at":"2026-02-08T16:32:05.648404175-08:00","created_by":"Mike Macpherson"}]}
{"id":"tenforty-osu","title":"Rust zip-mode eval_scenarios entry point","description":"Add a Rust-side entry point that accepts pre-formed scenario lists without forming a Cartesian product. The current eval_scenarios in python.rs builds the product internally (lines 237-284). Need a parallel path that takes scenarios as-is and still benefits from JIT/SIMD batching and Rayon parallelism. Key files: crates/tenforty-graph/src/python.rs, crates/tenforty-graph/src/eval.rs","status":"closed","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:31:22.198732827-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T20:44:55.253119166-08:00","closed_at":"2026-02-08T20:44:55.253119166-08:00","close_reason":"Implemented: Rust eval_scenarios_zip, Python evaluate_batch_zip/evaluate_returns_zip, OTS fallback in evaluate_returns_zip"}
{"id":"tenforty-qbw","title":"Test issue","status":"tombstone","priority":4,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T13:37:47.674001718-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T13:37:54.215436108-08:00","deleted_at":"2026-02-08T13:37:54.215436108-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"tenforty-qqx","title":"Add OTS state support for 2021-2018 (NC, NJ, PA, VA, OH)","description":"Extend state support further back (2021, 2020, 2019, 2018) for the same 5 states (NC, NJ, PA, VA, OH). Same pattern, low marginal effort per year. Can be done incrementally. Key files: src/tenforty/models.py, tests/parity/","status":"open","priority":3,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:48:45.518321023-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T16:48:45.518321023-08:00","dependencies":[{"issue_id":"tenforty-qqx","depends_on_id":"tenforty-6t0","type":"blocks","created_at":"2026-02-08T16:49:06.701547903-08:00","created_by":"Mike Macpherson"}]}
{"id":"tenforty-s66","title":"Add OTS state support for 2023 (NC, NJ, PA, VA, OH)","description":"Same as 2024 task but for 2023. Only 5 states (no MI/OR - they weren't in OTS until 2024). Add NaturalFormMapping configs and xfail parity tests for NC_D400, NJ_1040, PA_40, VA_760, OH_IT1040. Key files: src/tenforty/models.py, tests/parity/","status":"open","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T16:48:42.385119764-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T16:48:42.385119764-08:00"}
{"id":"tenforty-uur","title":"MCP Makefile API","description":"Create a Makefile with targets for building/running the MCP server. Provide a small 'make API' for common tasks.","status":"open","priority":2,"issue_type":"task","owner":"mmacpherson@users.noreply.github.com","created_at":"2026-02-08T15:37:01.182481023-08:00","created_by":"Mike Macpherson","updated_at":"2026-02-08T15:37:01.182481023-08:00"}
